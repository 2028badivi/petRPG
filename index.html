<!DOCTYPE html>
<html lang="en">
    <!-- We are importing all the modules and open source script here in the head section-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PetRPG</title>
    <meta name="description" content="A game for TJFBLA Intro to Programming 2026.">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="https://unpkg.com/blockly/blocks_compressed.js"></script>
    <script src="https://unpkg.com/blockly/javascript_compressed.js"></script>
    <script src="https://unpkg.com/blockly/msg/en.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
    <div id="app">

        <section id="auth-screen" class="view active">
            <div class="glass-card fade-in">
                <!-- The name of the game -->
                <h1>PetRPG</h1>
                <p class="subtitle">Sign in</p>


                <!-- We made a placeholder with the textfield and also disabled autocomplete because we wanted it to be a unique entity. -->
                <div class="input-group">
                    <input type="text" id="username-input" placeholder="What's your name?" autocomplete="off">
                </div>
                <button id="login-btn" class="primary-btn">Start game</button>
            </div>
        </section>


        <!-- log in screen-->
        <section id="onboarding-screen" class="view">
            <div class="glass-card fade-in">
                <h2>Choose your pet</h2>
                <!-- start the onboarding process -->
                <div id="onboarding-steps">
                    <div class="step active" data-step="1">
                        <p>What is your pet's name?</p>
                        <input type="text" id="q1" placeholder="e.g. bob">
                    </div>
                    <div class="step" data-step="2">
                        <!--radio buttons to choose pet-->
                        <p>Choose your companion</p>
                        <div class="pet-selection-grid"
                            style="display: flex; gap: 1rem; justify-content: center; margin: 1.5rem 0;">
                            <label class="pet-card">
                                <input type="radio" name="pet-choice" value="cat" class="pet-radio">
                                <div class="pet-card-content">
                                    <div class="pet-icon"></div>
                                    <span>Cat</span>
                                </div>
                            </label>
                            <label class="pet-card">
                                <input type="radio" name="pet-choice" value="dog" class="pet-radio">
                                <div class="pet-card-content">
                                    <div class="pet-icon"></div>
                                    <span>Dog</span>
                                </div>
                            </label>
                            <label class="pet-card">
                                <input type="radio" name="pet-choice" value="rabbit" class="pet-radio">
                                <div class="pet-card-content">
                                    <div class="pet-icon"></div>
                                    <span>Rabbit</span>
                                </div>
                            </label>
                        </div>
                        <input type="hidden" id="q2">
                    </div>
                    <div class="step" data-step="3">
                        <p>You're ready to start!</p>
                        <button id="finish-onboarding" class="primary-btn">Create Account</button>
                    </div>
                </div>
                <div class="step-controls">
                    <button id="next-step" class="secondary-btn">Next</button>
                </div>
            </div>
        </section>


        <!-- main game-->
        <section id="game-screen" class="view">
            <div class="game-ui">
                <div class="user-badge">
                    <p>Hello, </p>
                    <span id="display-name"></span>
                    <button id="logout-btn">log out</button>
                </div>
                <div class="controls-hint">use WASD or arrow keys to move around!</div>
            </div>

            <div class="world-viewport">
                <div class="world-grid"></div>
                <div id="obstacles-container"></div>
                <div id="stations-container"></div>
                <!-- This is the person you control -->
                <div id="character" class="pixel-human"></div>
                <!-- This is your pet friend -->
                <div id="pet" class="pet"></div>
            </div>
            <!--sidebar that shows all active blocks-->
            <div id="status-sidebar" class="status-sidebar">
                <div class="sidebar-drag-handle" id="sidebar-drag"></div>
                <div class="sidebar-header">
                    <h3>Status & Schedule</h3>
                    <div class="sidebar-meta">
                        <h3 id="levelHeader">Level: 1</h3>
                        <span class="meta-separator">|</span>
                        <h3 id="livesHeader">Lives: 2</h3>
                    </div>
                </div>
                <div class="stats-overview">
                    <div class="mini-stat" title="Health">
                        <div class="circle-progress" id="mini-health"></div>
                        <span class="mini-label">HLT</span>
                    </div>
                    <div class="mini-stat" title="Happiness">
                        <div class="circle-progress" id="mini-happiness"></div>
                        <span class="mini-label">HAP</span>
                    </div>
                    <div class="mini-stat" title="Hunger">
                        <div class="circle-progress" id="mini-hunger"></div>
                        <span class="mini-label">HGR</span>
                    </div>
                    <div class="mini-money">
                        <span id="mini-val-money">$0</span>
                    </div>

                </div>
                <div id="scheduled-actions-list" class="sidebar-content">

                </div>

                <div class="sidebar-footer">
                    <button id="execute-all-btn" class="primary-btn">Execute All</button>
                </div>
            </div>



        </section>
    </div>

    <!--overlay when you enter station-->
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <button id="close-modal" class="close-modal">&times;</button>
            <h2 id="modal-title">Station</h2>
            <div id="station-interface" class="vet-interface" style="display: none;">
                <div class="left-panel">
                    <!--Progress bars in the overlay-->
                    <div class="modal-pet-display">
                        <div id="modal-pet-sprite" class="pet"></div>
                    </div>
                    <div class="stats-container">
                        <div class="stat-item">
                            <label>Health</label>
                            <div class="bar-bg">
                                <div id="bar-health" class="bar-fill"></div>
                            </div>
                            <div id="val-health" class="stat-val">0 / 100</div>
                        </div>
                        <div class="stat-item">
                            <label>Happiness</label>
                            <div class="bar-bg">
                                <div id="bar-happiness" class="bar-fill"></div>
                            </div>
                            <div id="val-happiness" class="stat-val">0 / 100</div>
                        </div>
                        <div class="stat-item">
                            <label>Hunger</label>
                            <div class="bar-bg">
                                <div id="bar-hunger" class="bar-fill"></div>
                            </div>
                            <div id="val-hunger" class="stat-val">0 / 100</div>
                        </div>
                        <div class="stat-item">
                            <label>Hygiene</label>
                            <div class="bar-bg">
                                <div id="bar-hygiene" class="bar-fill"></div>
                            </div>
                            <div id="val-hygiene" class="stat-val">0 / 100</div>
                        </div>
                        <div class="stat-item">
                            <label>Energy</label>
                            <div class="bar-bg">
                                <div id="bar-energy" class="bar-fill"></div>
                            </div>
                            <div id="val-energy" class="stat-val">0 / 100</div>
                        </div>
                        <div class="stat-item">
                            <label>Money</label>
                            <div id="val-money" class="stat-val"
                                style="font-size: 1.5rem; font-weight: bold; color: #2ecc71;">$0</div>
                        </div>
                    </div>
                </div>
                <div class="right-panel">
                    <h3 id="station-subtitle">Pet Logic Editor</h3>
                    <div class="block-editor">
                        <div id="blocklyDiv"></div>
                    </div>
                    <div style="height: 3rem;"></div>
                </div>
            </div>
            <!--Q&A Station-->
            <div id="ai-interface" class="ai-interface" style="display: none;">
                <div class="faq-panel">
                    <h3>Quick Guide & FAQ</h3>
                    <div class="faq-list">
                        <div class="faq-item">
                            <span class="faq-q">How do I move around?</span>
                            <span class="faq-a">Use WASD or Arrow Keys! Walk onto a station and press Spacebar to
                                enter.</span>
                        </div>
                        <div class="faq-item">
                            <span class="faq-q">How do I schedule an action?</span>
                            <span class="faq-a">Each station has a logic editor. You can drag blocks to "schedule"
                                actions like feeding or playing. Each station will have their own unique actions, and
                                the status and schedule panel will allow you to run all blocks for the day and move onto
                                the next level. Running commands in individual stations will only show you a temporary
                                effect and not change your variables. In order to change your variables - aka run
                                actions for the day - you need to "execute all" in the command sidebar in the 1D
                                interface.</span>
                        </div>
                        <div class="faq-item">
                            <span class="faq-q">Buying Food</span>
                            <span class="faq-a">Go to the Grocery Store station, use the "Buy Food" block in your
                                schedule, and execute it!</span>
                        </div>
                        <div class="faq-item">
                            <span class="faq-q">Automation (Execute All)</span>
                            <span class="faq-a">The blue button on your sidebar runs ALL schedules from all stations at
                                once. It's the ultimate pet-care tool! See effects in seconds, not days.</span>
                        </div>
                        <div class="faq-item">
                            <span class="faq-q">Station Locations</span>
                            <span class="faq-a">Home (left side), Grocery Store (top right), Vet (bottom), and AI Guide
                                (bottom right).</span>
                        </div>
                        <div class="faq-item">
                            <span class="faq-q">Leveling Up</span>
                            <span class="faq-a"> Each time you run a day (executing all), your pet levels up by 1 level.
                                Every level, variables such as hunger are harder to
                                increment, meaning the overall gameplay gets harder. However, executing in specific
                                stations does not level you up, as they are sandbox areas.
                            </span>
                        </div>
                    </div>
                </div>
                <div class="chat-panel">
                    <div class="chat-container">
                        <div id="chat-messages" class="chat-messages">
                            <div class="message assistant">Welcome to our project! I'm RP AI. Ask me anything about
                                PetRPG!</div>
                        </div>
                        <div class="chat-input-area">
                            <input type="text" id="ai-chat-input" placeholder="Ask a follow-up question..."
                                autocomplete="off">
                            <button id="ai-send-btn">Send</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="generic-content" style="display: none;">
                <p>Coming soon...</p>
            </div>
        </div>
    </div>

    <!-- Game Over Overlay -->
    <div id="game-over-overlay" class="modal-overlay"
        style="display: none; background: rgba(0,0,0,0.95); z-index: 200;">
        <div class="glass-card fade-in" style="max-width: 500px;">
            <h1 style="color: #ef4444; font-size: 3.5rem; margin-bottom: 1rem;">GAME OVER</h1>
            <p style="margin-bottom: 2rem;">You ran out of lives! Your pet couldn't keep up with the schedule.</p>
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                <button id="view-summary-btn" class="secondary-btn" style="width: 100%;">View Summary</button>
                <button id="restart-game-btn" class="primary-btn" style="background: #ef4444;">Restart Account</button>
            </div>
        </div>
    </div>

    <!-- Summary Overlay -->
    <div id="summary-overlay" class="modal-overlay" style="display: none; z-index: 210;">
        <div class="glass-card fade-in" style="max-width: 400px; position: relative;">
            <button id="close-summary" class="close-modal">&times;</button>
            <h2>Daily Summary</h2>
            <div style="margin: 2rem 0; text-align: left; color: var(--text-dim);">
                <div id="summary-content">Summary here...</div>
                <!-- Placeholder for dynamic summary if needed later -->
            </div>
        </div>
    </div>

    <!-- Random Event Overlay -->
    <div id="event-overlay" class="modal-overlay" style="display: none; z-index: 150;">
        <div class="glass-card fade-in"
            style="max-width: 450px; text-align: center; border: 1px solid var(--accent-primary);">
            <h2 id="event-title" style="color: var(--accent-primary); margin-bottom: 1rem;">Sudden Event!</h2>
            <p id="event-description" style="font-size: 1.1rem; margin-bottom: 1.5rem; line-height: 1.6;"></p>
            <div id="event-stat-changes" style="margin-bottom: 2rem; font-weight: bold;"></div>
            <button id="close-event-btn" class="primary-btn" style="width: 100%;">Got it!</button>
        </div>
    </div>

    <xml id="toolbox" style="display: none">
        <category name="Movement" colour="210">
            <block type="move_forward"></block>
            <block type="turn_left"></block>
            <block type="turn_right"></block>
        </category>
        <category name="Actions" colour="120">
            <block type="feed_pet"></block>
            <block type="play_pet"></block>
            <block type="wash_pet"></block>
            <block type="heal_pet"></block>
            <block type="daily_checkup"></block>
            <block type="buy_food"></block>
            <block type="sleep"></block>
            <block type="work"></block>
        </category>
        <category name="Logic" colour="210">
            <block type="controls_if"></block>
            <block type="logic_compare"></block>
            <block type="logic_operation"></block>
        </category>
    </xml>

    <!-- This is the brain of the game -->
    <script src="script.js"></script>
</body>

</html>
